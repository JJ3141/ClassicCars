@model IEnumerable<ClassicCars.Models.Car>

<link rel="stylesheet" href="~/css/collection-card.css" />

<header class="nav-bar">
    <div class="logo">R</div>
    <nav>
        <a asp-controller="Home" asp-action="Index">Home</a>
        <a asp-controller="Collection" asp-action="Index">Collections</a>

        @if (Context.Session.GetInt32("UserId") != null)
        {
            <form asp-controller="Profile" asp-action="Index" method="get" style="display:inline;">
                <button type="submit" class="profile-btn">Profile</button>
            </form>
            <form asp-controller="Login" asp-action="Logout" method="post" style="display:inline;">
                <button type="submit" class="logout-btn">Log Out</button>
            </form>
        }
        else
        {
            <form asp-controller="Register" asp-action="Register" method="get" style="display:inline;">
                <button type="submit" class="signin-btn">Sign In</button>
            </form>

            <form asp-controller="Login" asp-action="Login" method="get" style="display:inline;">
                <button type="submit" class="login-btn">Log In</button>
            </form>
        }
    </nav>
</header>

<div class="page">
    <div class="controls">
        <input type="text" id="searchInput" placeholder="Търсене..." />
        <div class="buttons">
            <button type="button" onclick="sortByPrice()">Показване по цена</button>
        </div>
    </div>

    <div class="cards" id="cardsContainer">
        @foreach (var car in Model)
        {
            <a asp-controller="Cars"
               asp-action="Details"
               asp-route-id="@car.Id"
               class="card-link">

                <div class="card" data-price="@car.Price" data-model="@car.Brand @car.Model">
                    <div class="card-img">
                        <img src="@car.ImageUrl" alt="Car" />
                    </div>

                    <div class="card-info">
                        <span><strong>Brand:</strong> @car.Brand</span>
                        <span><strong>Model:</strong> @car.Model</span>
                        <span><strong>Price:</strong> @car.Price лв.</span>
                    </div>

                    <p class="desc"><strong>Description:</strong> @car.Description</p>
                </div>
            </a>

        }

    </div>
    <div class="pagination">
        @for (int i = 1; i <= ViewBag.TotalPages; i++)
        {
            if (i == ViewBag.CurrentPage)
            {
                <span class="page active">@i</span>
            }
            else
            {
                <a class="page" asp-action="Index" asp-route-page="@i">@i</a>
            }
        }
    </div>
</div>

<section class="footer-hero">
    <h3>Discover the Golden Age of the Automobiles</h3>
</section>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const searchInput = document.getElementById("searchInput");
            const container = document.getElementById("cardsContainer");
            searchInput.addEventListener("input", () => {
                const value = searchInput.value.toLowerCase();
                const cards = Array.from(container.querySelectorAll(".card-link"));
                const visibleCards = cards.filter(card => {
                    const model = card.querySelector(".card-info span:nth-child(1)").textContent.toLowerCase();
                    return model.includes(value);
                });
                cards.forEach(card => card.style.display = "none");
                visibleCards.forEach(card => {
                    card.style.display = "block";
                    container.appendChild(card);
                });
            });
        });

        let priceAsc = true;

        function sortByPrice() {
            const container = document.getElementById("cardsContainer");
            const cards = Array.from(container.querySelectorAll(".card-link"));

            cards.sort((a, b) => {
                const priceA = Number(a.querySelector(".card-info span:nth-child(3)").textContent.replace(/\D/g, ''));
                const priceB = Number(b.querySelector(".card-info span:nth-child(3)").textContent.replace(/\D/g, ''));
                return priceAsc ? priceA - priceB : priceB - priceA;
            });

            priceAsc = !priceAsc;
            cards.forEach(card => container.appendChild(card));
        }</script>
}

